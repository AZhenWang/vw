create table features(
   id INT NOT NULL AUTO_INCREMENT,
   name VARCHAR(30) NOT NULL,
   remark text null comment'特征说明',
   created_at timestamp not null default CURRENT_TIMESTAMP,
   PRIMARY KEY(id),
   index(`name`)
)ENGINE=Innodb DEFAULT CHARSET=utf8 comment'特征定义';

create table features_groups(
   id INT NOT NULL AUTO_INCREMENT,
   feature_id int not null comment'特征id',
   group_number varchar(16) not null comment '组号, 例如daily-1',
   created_at timestamp not null default CURRENT_TIMESTAMP,
   PRIMARY KEY(id),
   index(`group_number`),
   index(`feature_id`)
)ENGINE=Innodb DEFAULT CHARSET=utf8 comment'特征组合表';


create table classifiers(
   id INT NOT NULL AUTO_INCREMENT,
   class_name varchar(10) not null comment'分类器名，例如：knn',
   params text null comment '参数值，json格式',
   created_at timestamp not null default CURRENT_TIMESTAMP,
   PRIMARY KEY(id)
)ENGINE=Innodb DEFAULT CHARSET=utf8 comment'聚类模型';


create table classified_v(
   date_id INT NOT NULL,
   code_id INT NOT NULL,
   classifier_id int not null comment'聚类模型表id',
   feature_group_number varchar(16) not null comment'特征组合表的组号',
   classifier_v float not null comment'预测值',
   metric_type varchar(10) null comment'指标类型，R2: R2分数， RODR: rate of daily return日收益率变化率',
   metric_v float null comment '指标值',
   created_at timestamp not null default CURRENT_TIMESTAMP,
   KEY (code_id),
   KEY (classifier_id),
   KEY (feature_group_number),
   CONSTRAINT `classifier_id_v` FOREIGN KEY (`classifier_id`) REFERENCES `classifiers` (`id`) on delete cascade on update cascade,
   unique KEY `unique_code_date`(`date_id`, `code_id`, `classifier_id`, `feature_group_number`)
)ENGINE=Innodb DEFAULT CHARSET=utf8 comment'聚类模型预测值';


# batch插入数据
insert into classifiers (class_name, params) values ('knn_60', '{"sample_interval":240,"pre_predict_interval":5,"memory_size":60}')